import{a as q}from"./chunk-PJMKHLN3.js";import{a as A,b as L,c as U,d as B,e as j,f as x,g as O,h as z,i as G}from"./chunk-FU5XF3DT.js";import"./chunk-7LJBHI36.js";import{B as _,D as P,F as y,H as F,K as r,L as a,M as E,N as V,O as S,P as W,T as I,U as l,V as c,W as C,Y as h,Z as f,_ as w,aa as k,c as v,ka as T,m as g,ma as D,n as M,oa as N,r as s,s as p,sa as R,w as b,y as o}from"./chunk-KXOE7I45.js";function H(m,K){if(m&1&&(r(0,"div",4)(1,"p"),l(2),a(),E(3,"img",19),a()),m&2){let n=W();o(2),c(n.t("imagePreview")),o(),y("src",n.imagePreview(),b)}}var J="http://localhost:3000",re=(()=>{class m{constructor(){this.route=g(D),this.router=g(N),this.api=g(q),this.i18n=g(R),this.product={name:"",description:"",price:0,stock:0},this.imageFile=null,this.imagePreview=_(null),this.isEditMode=_(!1),this.t=this.i18n.t.bind(this.i18n)}ngOnInit(){let n=this.route.snapshot.paramMap.get("id");n&&(this.isEditMode.set(!0),this.loadProduct(n))}loadProduct(n){return v(this,null,function*(){try{let t=yield this.api.getProduct(n);if(this.product=t,t.image){let e=t.image.startsWith("http")?t.image:`${J}${t.image}`;this.imagePreview.set(e)}}catch{this.router.navigate(["/"])}})}handleImageUpload(n){let t=n.target.files?.[0];if(t){this.imageFile=t;let e=new FileReader;e.onload=d=>this.imagePreview.set(d.target?.result),e.readAsDataURL(t)}}handleSubmit(){return v(this,null,function*(){let n=new FormData;Object.keys(this.product).forEach(t=>{let e=t;e!=="id"&&e!=="image"&&this.product[e]!=null&&n.append(e,String(this.product[e]))}),this.imageFile&&n.append("image",this.imageFile);try{this.isEditMode()&&this.product.id?yield this.api.updateProduct(this.product.id,n):yield this.api.addProduct(n),this.router.navigate(["/"])}catch(t){console.error("Falha ao salvar produto",t),alert("Falha ao salvar produto. Verifique o console para mais detalhes.")}})}static{this.\u0275fac=function(t){return new(t||m)}}static{this.\u0275cmp=M({type:m,selectors:[["app-product-form"]],standalone:!0,features:[k],decls:30,vars:13,consts:[["f","ngForm"],[1,"form-container"],[1,"text-center","mb-4"],[3,"ngSubmit"],[1,"mb-3"],["for","name",1,"form-label"],["type","text","id","name","name","name","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","description",1,"form-label"],["id","description","name","description","rows","3","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"row"],[1,"col-md-6","mb-3"],["for","price",1,"form-label"],["type","number","id","price","name","price","step","0.01","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","stock",1,"form-label"],["type","number","id","stock","name","stock","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","image",1,"form-label"],["type","file","id","image",1,"form-control",3,"change"],[1,"d-grid"],["type","submit",1,"btn","btn-primary",3,"disabled"],["alt","Preview",1,"img-preview",3,"src"]],template:function(t,e){if(t&1){let d=V();r(0,"div",1)(1,"h2",2),l(2),a(),r(3,"form",3,0),S("ngSubmit",function(){return s(d),p(e.handleSubmit())}),r(5,"div",4)(6,"label",5),l(7),a(),r(8,"input",6),w("ngModelChange",function(i){return s(d),f(e.product.name,i)||(e.product.name=i),p(i)}),a()(),r(9,"div",4)(10,"label",7),l(11),a(),r(12,"textarea",8),w("ngModelChange",function(i){return s(d),f(e.product.description,i)||(e.product.description=i),p(i)}),a()(),r(13,"div",9)(14,"div",10)(15,"label",11),l(16),a(),r(17,"input",12),w("ngModelChange",function(i){return s(d),f(e.product.price,i)||(e.product.price=i),p(i)}),a()(),r(18,"div",10)(19,"label",13),l(20),a(),r(21,"input",14),w("ngModelChange",function(i){return s(d),f(e.product.stock,i)||(e.product.stock=i),p(i)}),a()()(),r(22,"div",4)(23,"label",15),l(24),a(),r(25,"input",16),S("change",function(i){return s(d),p(e.handleImageUpload(i))}),a()(),P(26,H,4,2,"div",4),r(27,"div",17)(28,"button",18),l(29),a()()()()}if(t&2){let d=I(4);o(2),C(" ",e.isEditMode()?e.t("productEditing"):e.t("productRegistration")," "),o(5),c(e.t("name")),o(),h("ngModel",e.product.name),o(3),c(e.t("description")),o(),h("ngModel",e.product.description),o(4),c(e.t("price")),o(),h("ngModel",e.product.price),o(3),c(e.t("stock")),o(),h("ngModel",e.product.stock),o(3),c(e.t("image")),o(2),F(e.imagePreview()?26:-1),o(2),y("disabled",d.invalid),o(),C(" ",e.t("save")," ")}},dependencies:[T,G,x,A,O,L,U,z,j,B],encapsulation:2,changeDetection:0})}}return m})();export{re as ProductFormComponent};
